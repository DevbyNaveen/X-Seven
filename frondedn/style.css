* { box-sizing: border-box; }
:root {
  --bg: #0b141a;
  --panel: #111b21;
  --panel-2: #1f2c33;
  --text: #e9edef;
  --muted: #8696a0;
  --sent: #005c4b;
  --sent-2: #0b846f;
  --recv: #1f2c33;
  --accent: #25d366;
  --danger: #ff4d4f;
}
html, body { height: 100%; }
body { margin: 0; background: var(--bg); color: var(--text); font: 14px/1.4 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
#app { height: 100vh; display: grid; grid-template-rows: auto 1fr auto; }

.app-header { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; background: var(--panel); border-bottom: 1px solid #172129; }
.title { display: flex; align-items: center; gap: 10px; }
.avatar { width: 36px; height: 36px; border-radius: 50%; display: grid; place-items: center; background: #223038; }
.name { font-weight: 600; }
.sub { font-size: 12px; color: var(--muted); }
.controls { display: flex; align-items: center; gap: 8px; }
.toggle { display: flex; align-items: center; gap: 6px; color: var(--muted); font-size: 12px; }
.biz-input { width: 120px; padding: 6px 8px; background: var(--panel-2); border: 1px solid #23323b; color: var(--text); border-radius: 8px; }
.btn { border: 0; padding: 8px 12px; border-radius: 10px; cursor: pointer; color: var(--text); background: #213038; }
.btn.ghost { background: transparent; border: 1px solid #22343f; }
.btn.primary { background: var(--accent); color: #052e17; font-weight: 700; }
.btn:disabled { opacity: .6; cursor: not-allowed; }
.dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
.dot.off { background: #4a5c64; }
.dot.on { background: #21d07a; box-shadow: 0 0 0 2px rgba(33,208,122,.2); }

.chat { background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="304" height="304" viewBox="0 0 304 304"><g fill="%23131f26" fill-opacity="0.6"><circle cx="16" cy="16" r="2"/><circle cx="152" cy="80" r="2"/><circle cx="288" cy="144" r="2"/><circle cx="80" cy="224" r="2"/></g></svg>') repeat; }
.messages { list-style: none; margin: 0; padding: 16px; display: flex; flex-direction: column; gap: 8px; max-height: calc(100vh - 160px); overflow-y: auto; }

.msg { display: flex; }
.msg .bubble { max-width: min(75%, 680px); padding: 8px 10px; border-radius: 12px; position: relative; white-space: pre-wrap; word-wrap: break-word; }
.msg.user { justify-content: flex-end; }
.msg.user .bubble { background: linear-gradient(180deg, var(--sent), var(--sent-2)); border-bottom-right-radius: 4px; }
.msg.bot .bubble { background: var(--recv); border-bottom-left-radius: 4px; }
.timestamp { margin-top: 2px; font-size: 11px; color: var(--muted); }

/* Typing caret on streaming bot bubble */
.msg.bot.typing .bubble { position: relative; }
.msg.bot.typing .bubble::after {
  content: '';
  display: inline-block;
  width: 7px;
  height: 1em;
  margin-left: 4px;
  background: #7fa7b7;
  border-radius: 1px;
  animation: caretBlink .9s steps(1) infinite;
  vertical-align: -2px;
}
@keyframes caretBlink {
  0%, 40% { opacity: 1; }
  50%, 100% { opacity: 0; }
}

.composer { padding: 8px 12px; background: var(--panel); border-top: 1px solid #172129; }
.composer-inner { display: flex; gap: 8px; align-items: flex-end; background: var(--panel-2); border: 1px solid #23323b; border-radius: 14px; padding: 8px; }
#input { flex: 1; background: transparent; border: 0; outline: none; color: var(--text); resize: none; max-height: 180px; }
.actions { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 4px 0; }
.action-btn { background: transparent; border: 1px solid #2a3a43; color: var(--text); padding: 6px 10px; border-radius: 16px; cursor: pointer; font-size: 12px; }
.action-btn:hover { border-color: var(--accent); color: var(--accent); }

/* Scrollbar */
.messages::-webkit-scrollbar { width: 10px; }
.messages::-webkit-scrollbar-thumb { background: #2a3942; border-radius: 8px; }

/* --- Markdown styling inside chat bubbles --- */
.msg .bubble h1,
.msg .bubble h2,
.msg .bubble h3,
.msg .bubble h4 {
  margin: 8px 0 6px;
  line-height: 1.25;
}
.msg .bubble h1 { font-size: 18px; }
.msg .bubble h2 { font-size: 16px; }
.msg .bubble h3 { font-size: 15px; }
.msg .bubble h4 { font-size: 14px; }

.msg .bubble p { margin: 6px 0; }

.msg .bubble ul,
.msg .bubble ol {
  margin: 6px 0 6px 18px;
  padding-left: 18px;
}
.msg .bubble li { margin: 4px 0; }

.msg .bubble a { color: var(--accent); text-decoration: underline; word-break: break-word; }

.msg .bubble code {
  background: #0f1c22;
  border: 1px solid #23323b;
  border-radius: 6px;
  padding: 2px 5px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12px;
}

.msg .bubble pre {
  background: #0f1c22;
  border: 1px solid #23323b;
  border-left: 4px solid #2a3a43;
  border-radius: 8px;
  padding: 10px;
  overflow-x: auto;
  margin: 8px 0;
}
.msg .bubble pre code {
  background: transparent;
  border: 0;
  padding: 0;
  font-size: 12px;
}

.msg .bubble blockquote {
  border-left: 4px solid #2a3a43;
  margin: 8px 0;
  padding: 6px 10px;
  background: #0f1c22;
  color: #c7d1d8;
  border-radius: 6px;
}

.msg .bubble img {
  max-width: 100%;
  border-radius: 8px;
  display: block;
}

.msg .bubble table {
  width: 100%;
  border-collapse: collapse;
  margin: 8px 0;
  background: #102028;
  border: 1px solid #23323b;
}
.msg .bubble th,
.msg .bubble td {
  border: 1px solid #23323b;
  padding: 6px 8px;
}
.msg .bubble th { background: #13242d; text-align: left; }
