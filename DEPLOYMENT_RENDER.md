# ðŸš€ X-SevenAI Backend Deployment to Render

This guide will help you deploy your X-SevenAI backend to Render.

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **Git Repository**: Push your code to GitHub/GitLab
3. **API Keys**: Collect all required API keys (OpenAI, Twilio, Stripe, etc.)

## ðŸ“‹ Step-by-Step Deployment

### Step 1: Connect Your Repository

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New" â†’ "Blueprint" or "Web Service"
3. Connect your GitHub/GitLab repository
4. Render will automatically detect the `render.yaml` file

### Step 2: Configure Services

Render will create three services based on your `render.yaml`:

1. **Web Service** (`x-sevenai-backend`): Your FastAPI application
2. **PostgreSQL** (`x-sevenai-db`): Database service
3. **Redis** (`x-sevenai-redis`): Cache and background tasks

### Step 3: Set Environment Variables

In your Render dashboard, go to your web service and add these environment variables:

#### Required API Keys (Set These Manually)

```bash
# AI Services
OPENAI_API_KEY=sk-your-openai-key-here
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key
GROQ_API_KEY=gsk-your-groq-key
ELEVENLABS_API_KEY=your-elevenlabs-key

# Communication Services
TWILIO_ACCOUNT_SID=AC-your-twilio-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=+1234567890

# Payment Processing
STRIPE_SECRET_KEY=sk_live_your-stripe-secret
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# WhatsApp (if using)
WHATSAPP_UNIVERSAL_NUMBER=+1234567890
WHATSAPP_API_KEY=your-whatsapp-api-key
WHATSAPP_WEBHOOK_TOKEN=your-webhook-token

# Optional Phone Providers
VONAGE_API_KEY=your-vonage-key
VONAGE_API_SECRET=your-vonage-secret
MESSAGEBIRD_API_KEY=your-messagebird-key

# Vector Database (if using external Qdrant)
QDRANT_URL=https://your-qdrant-instance.com
QDRANT_API_KEY=your-qdrant-key

# Supabase (if using)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_API_KEY=your-supabase-anon-key
SUPABASE_JWT_SECRET=your-supabase-jwt-secret
```

#### Auto-Configured Variables (Don't Set These)

These will be automatically configured by Render:
- `DATABASE_URL` (from PostgreSQL service)
- `REDIS_URL` (from Redis service)
- `CELERY_BROKER_URL` (from Redis service)
- `CELERY_RESULT_BACKEND` (from Redis service)

### Step 4: Update CORS Origins

Update the `BACKEND_CORS_ORIGINS` environment variable with your frontend domain:

```bash
BACKEND_CORS_ORIGINS=["https://your-frontend-domain.com", "https://www.your-frontend-domain.com"]
```

### Step 5: Deploy

1. Click "Create Web Service" in Render
2. Wait for the build to complete (this may take 10-15 minutes)
3. Your API will be available at: `https://your-service-name.onrender.com`

### Step 6: Database Setup

After deployment, you may need to run database migrations:

1. Connect to your Render service via SSH or use Render's shell
2. Run: `alembic upgrade head`

Or add this to your build command if you have migrations to run.

## ðŸ”§ Troubleshooting

### Build Failures

**Common Issues:**
- Missing dependencies in `requirements.txt`
- Environment variables not set correctly
- Database connection issues during build

**Solutions:**
1. Check the build logs in Render dashboard
2. Ensure all required environment variables are set
3. Verify your `requirements.txt` includes all dependencies

### Runtime Issues

**Common Issues:**
- Database connection failures
- Redis connection issues
- Missing API keys

**Solutions:**
1. Check the service logs in Render dashboard
2. Verify environment variables are correctly set
3. Ensure your database and Redis services are running

### WebSocket Issues

If WebSockets aren't working:
1. Ensure your frontend is connecting to the correct WebSocket URL
2. Check CORS settings include your frontend domain
3. Verify WebSocket origins are properly configured

## ðŸ“Š Monitoring

### Health Checks

Your API includes health check endpoints:
- `GET /health` - Basic health check
- `GET /` - API root with environment info

### Logs

Monitor your application logs in the Render dashboard under the "Logs" tab.

## ðŸ”’ Security Notes

1. **Never commit secrets** to your repository
2. **Use Render's secret management** for sensitive environment variables
3. **Enable HTTPS** (automatically enabled by Render)
4. **Configure CORS** properly for your domains
5. **Use strong SECRET_KEY** (auto-generated by Render)

## ðŸ’° Cost Estimation

**Free Tier:**
- Web Service: 750 hours/month
- PostgreSQL: 750 hours/month, 256MB storage
- Redis: 750 hours/month

**Paid Plans:** Start at $7/month for web services with more resources.

## ðŸš€ Post-Deployment

1. **Test your API** using the provided URL
2. **Update your frontend** to point to the new API URL
3. **Configure domain** (optional) in Render dashboard
4. **Set up monitoring** and alerts as needed
5. **Configure backups** for your database

## ðŸ“ž Support

If you encounter issues:
1. Check Render's documentation
2. Review the build and runtime logs
3. Ensure all environment variables are set correctly
4. Verify your `render.yaml` configuration

Your X-SevenAI backend should now be successfully deployed to Render! ðŸŽ‰
